#!/usr/bin/env bash
# Title: WiFi Penetration Testing Toolkit
# Description: This script assists in the penetration testing of WPA/WPA2 networks.
# It checks for the presence of the aircrack-ng suite, sets up monitor mode on the wireless interface,
# captures the WPA handshake, and attempts to crack the password using a provided wordlist.
# Author: Jay-Alexander Elliot
# Date: 2024-01-20
# Usage: Execute this script in a bash environment with necessary permissions.
# Follow the prompts to install Aircrack-ng suite if not present, and ensure you have a compatible wireless interface.

# DISCLAIMER: This tool is intended for educational and authorized penetration testing purposes only.
# The author takes no responsibility for any misuse of this tool.

# Utility function to request user input with validation
request_input() {
    local prompt=$1
    local validation=$2
    local input
    while true; do
        read -p "$prompt" input
        if [[ $input =~ $validation ]]; then
            echo $input
            break
        else
            echo "Invalid input, please try again."
        fi
    done
}

# Function to check for Aircrack-ng installation
check_aircrack() {
    if ! command -v aircrack-ng &> /dev/null; then
        local answer_aircrack=$(request_input "Aircrack-ng is not installed. Do you want to install it? (y/n): " '^[yn]$')
        if [ "$answer_aircrack" = "y" ]; then
            sudo apt-get install aircrack-ng
            echo "Aircrack-ng installed successfully."
        else
            echo "Aircrack-ng is required to proceed. Please install it and try again."
            exit 1
        fi
    else
        echo "Aircrack-ng is already installed. Moving to the next step."
        sub_master
    fi
}

# Function to check for sudo privileges
check_privileges() {
    if [ "$(id -u)" != "0" ]; then
        echo "This script must be run as root. Please use sudo or run as root."
        exit 1
    fi
}

# Other function definitions (start, wlan_monitor, wlan_crack, pass_cap_crack, master, sub_master)
# remain mostly unchanged, but replace iwconfig with iw and add error handling where necessary.

# Start the script by checking for Aircrack-ng installation and privileges
check_privileges
check_aircrack
